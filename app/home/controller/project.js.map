{
    "version": 3,
    "sources": [
        "../../../src/home/controller/project.js"
    ],
    "names": [
        "Enum",
        "queryAction",
        "pageNo",
        "get",
        "pageSize",
        "session",
        "userInfo",
        "think",
        "isEmpty",
        "fail",
        "NOT_NOGIN",
        "code",
        "msg",
        "model",
        "join",
        "table",
        "as",
        "on",
        "page",
        "where",
        "id",
        "field",
        "countSelect",
        "result",
        "success",
        "pages",
        "totalCount",
        "totalPage",
        "tables",
        "count",
        "totalPages",
        "data",
        "queryallAction",
        "select",
        "addAction",
        "projectName",
        "projectPrefix",
        "proxyURL",
        "add",
        "projectId",
        "userId",
        "isManage",
        "insertId",
        "ADD_ERROR",
        "editAction",
        "update",
        "affectedRows",
        "EDIT_ERROR",
        "deleteAction",
        "interfaceCount",
        "DELETE_PROJECT_INTERFACE_ERROR",
        "delete",
        "DELETE_ERROR"
    ],
    "mappings": "AAAA;;;;;;;;;;;;;;;;;;;;;;;;AAEA;;;;AACA;;IAAaA,I;;;;;;;;;;;;;;AAGX;;;;mBAIMC,W;;;;;;;AACAC,oB,GAAS,KAAKC,GAAL,CAAS,QAAT,C;AACTC,sB,GAAW,KAAKD,GAAL,CAAS,UAAT,C;;qBACM,KAAKE,OAAL,CAAa,UAAb,C;;;AAAjBC,sB;;mBACDC,MAAMC,OAAN,CAAcF,QAAd,C;;;;;+CACM,KAAKG,IAAL,CAAUT,KAAKU,SAAL,CAAeC,IAAzB,EAA+BX,KAAKU,SAAL,CAAeE,GAA9C,C;;;;qBAEU,KAAKC,KAAL,CAAW,SAAX,EAAsBC,IAAtB,CAA2B;AAC5CC,uBAAO,UADqC;AAE5CD,sBAAM,OAFsC;AAG5CE,oBAAI,IAHwC;AAI5CC,oBAAI,CAAC,IAAD,EAAO,WAAP;AAJwC,eAA3B,EAKhBC,IALgB,CAKXhB,MALW,EAKHE,QALG,EAKOe,KALP,CAKa,EAAC,aAAab,SAASc,EAAvB,EALb,EAKyCC,KALzC,CAK+C,2IAL/C,EAK4LC,WAL5L,E;;;AAAfC,oB;;mBAMDhB,MAAMC,OAAN,CAAce,MAAd,C;;;;;+CACM,KAAKC,OAAL,CAAa,EAACC,OAAO,EAACvB,QAAQA,MAAT,EAAiBE,UAAUA,QAA3B,EAAqCsB,YAAY,CAAjD,EAAoDC,WAAW,CAA/D,EAAR,EAA2EC,QAAQ,EAAnF,EAAb,C;;;+CAEF,KAAKJ,OAAL,CAAa,EAACC,OAAO,EAACvB,QAAQA,MAAT,EAAiBE,UAAUA,QAA3B,EAAqCsB,YAAYH,OAAOM,KAAxD,EAA+DF,WAAWJ,OAAOO,UAAjF,EAAR,EAAsGF,QAAQL,OAAOQ,IAArH,EAAb,C;;;;;;;;;;;;;;;;;mBAGHC,c;;;;;;;;qBACiB,KAAK3B,OAAL,CAAa,UAAb,C;;;AAAjBC,sB;;mBACDC,MAAMC,OAAN,CAAcF,QAAd,C;;;;;gDACM,KAAKG,IAAL,CAAUT,KAAKU,SAAL,CAAeC,IAAzB,EAA+BX,KAAKU,SAAL,CAAeE,GAA9C,C;;;;qBAEU,KAAKC,KAAL,CAAW,SAAX,EAAsBC,IAAtB,CAA2B;AAC5CC,uBAAO,UADqC;AAE5CD,sBAAM,OAFsC;AAG5CE,oBAAI,IAHwC;AAI5CC,oBAAI,CAAC,IAAD,EAAO,WAAP;AAJwC,eAA3B,EAKhBE,KALgB,CAKV,EAAC,aAAab,SAASc,EAAvB,EALU,EAKkBC,KALlB,CAKwB,sDALxB,EAKgFY,MALhF,E;;;AAAfV,oB;gDAMG,KAAKC,OAAL,CAAaD,MAAb,C;;;;;;;;;;;;;;;;;mBAGHW,S;;;;;;;AACAC,yB,GAAc,KAAKhC,GAAL,CAAS,aAAT,C;AACdiC,2B,GAAgB,KAAKjC,GAAL,CAAS,eAAT,C;AAChBkC,sB,GAAW,KAAKlC,GAAL,CAAS,UAAT,C;;qBACM,KAAKE,OAAL,CAAa,UAAb,C;;;AAAjBC,sB;;mBACDC,MAAMC,OAAN,CAAcF,QAAd,C;;;;;gDACM,KAAKG,IAAL,CAAUT,KAAKU,SAAL,CAAeC,IAAzB,EAA+BX,KAAKU,SAAL,CAAeE,GAA9C,C;;;AAELC,mB,GAAQ,KAAKA,KAAL,CAAW,SAAX,C;AACZ;AACA;AACA;AACA;AACA;;;;qBAGwBA,MAAMyB,GAAN,CAAU,EAACH,aAAaA,WAAd,EAA2BC,eAAeA,aAA1C,EAAyDC,UAAUA,QAAnE,EAAV,C;;;AAAlBE,uB;;qBACiB,KAAK1B,KAAL,CAAW,UAAX,EAAuByB,GAAvB,CAA2B,EAACE,QAAQlC,SAASc,EAAlB,EAAsBmB,WAAWA,SAAjC,EAA4CE,UAAU,CAAtD,EAA3B,C;;;AAAjBC,sB;;;;;;;gDAIG,KAAKjC,IAAL,CAAUT,KAAK2C,SAAL,CAAehC,IAAzB,EAA+BX,KAAK2C,SAAL,CAAe/B,GAA9C,C;;;gDAEF,KAAKY,OAAL,E;;;;;;;;;;;;;;;;;mBAGHoB,U;;;;;;;AACAxB,gB,GAAK,KAAKjB,GAAL,CAAS,IAAT,C;AACLgC,yB,GAAc,KAAKhC,GAAL,CAAS,aAAT,C;AACdiC,2B,GAAgB,KAAKjC,GAAL,CAAS,eAAT,C;AAChBkC,sB,GAAW,KAAKlC,GAAL,CAAS,UAAT,C;AACXU,mB,GAAQ,KAAKA,KAAL,CAAW,SAAX,C;;qBACS,KAAKR,OAAL,CAAa,UAAb,C;;;AAAjBC,sB;;mBACDC,MAAMC,OAAN,CAAcF,QAAd,C;;;;;gDACM,KAAKG,IAAL,CAAUT,KAAKU,SAAL,CAAeC,IAAzB,EAA+BX,KAAKU,SAAL,CAAeE,GAA9C,C;;;;;qBAGkBC,MAAMM,KAAN,CAAY,EAACC,IAAIA,EAAL,EAAZ,EAAsByB,MAAtB,CAA6B,EAACV,aAAaA,WAAd,EAA2BC,eAAeA,aAA1C,EAAyDC,UAAUA,QAAnE,EAA7B,C;;;AAArBS,0B;;;;;;;gDAEG,KAAKrC,IAAL,CAAUT,KAAK+C,UAAL,CAAgBpC,IAA1B,EAAgCX,KAAK+C,UAAL,CAAgBnC,GAAhD,C;;;gDAEF,KAAKY,OAAL,E;;;;;;;;;;;;;;;;;mBAGHwB,Y;;;;;;;AACA5B,gB,GAAK,KAAKjB,GAAL,CAAS,IAAT,C;;qBACY,KAAKE,OAAL,CAAa,UAAb,C;;;AAAjBC,sB;;mBACDC,MAAMC,OAAN,CAAcF,QAAd,C;;;;;gDACM,KAAKG,IAAL,CAAUT,KAAKU,SAAL,CAAeC,IAAzB,EAA+BX,KAAKU,SAAL,CAAeE,GAA9C,C;;;AAELC,mB,GAAQ,KAAKA,KAAL,CAAW,SAAX,C;;AAENoC,4B,GAAiB,KAAKpC,KAAL,CAAW,WAAX,EAAwBQ,KAAxB,CAA8B,IAA9B,EAAoCF,KAApC,CAA0C,EAACoB,WAAWnB,EAAZ,EAA1C,EAA2DS,KAA3D,E;;oBAClBoB,iBAAiB,C;;;;;gDACX,KAAKxC,IAAL,CAAUT,KAAKkD,8BAAL,CAAoCvC,IAA9C,EAAoDX,KAAKkD,8BAAL,CAAoCtC,GAAxF,C;;;;qBAEH,KAAKC,KAAL,CAAW,UAAX,EAAuBM,KAAvB,CAA6B,EAACoB,WAAWnB,EAAZ,EAA7B,EAA8C+B,MAA9C,E;;;;qBACAtC,MAAMM,KAAN,CAAY,EAACC,IAAIA,EAAL,EAAZ,EAAsB+B,MAAtB,E;;;;;;;;;gDAEC,KAAK1C,IAAL,CAAUT,KAAKoD,YAAL,CAAkBzC,IAA5B,EAAkCX,KAAKoD,YAAL,CAAkBxC,GAApD,C;;;gDAEF,KAAKY,OAAL,E",
    "file": "../../../src/home/controller/project.js",
    "sourcesContent": [
        "'use strict';\n\nimport Base from './base.js';\nimport  * as Enum from '../../enum.js';\n\nexport default class extends Base {\n  /**\n   * index action\n   * @return {Promise} []\n   */\n  async queryAction(){\n    let pageNo = this.get(\"pageNo\");\n    let pageSize = this.get(\"pageSize\");\n    let userInfo = await this.session(\"userInfo\");\n    if(think.isEmpty(userInfo)) {\n      return this.fail(Enum.NOT_NOGIN.code, Enum.NOT_NOGIN.msg);\n    }\n    let result = await this.model(\"project\").join({\n      table: \"userAuth\",\n      join: \"inner\",\n      as: 'ua',\n      on: ['id', 'projectId']\n    }).page(pageNo, pageSize).where({'ua.userId': userInfo.id}).field(\"project.id,project.projectName,project.projectPrefix,project.proxyURL,date_format(project.createTime, '%Y-%c-%d %h:%i:%s' ) as createTime\").countSelect();\n    if(think.isEmpty(result)) {\n      return this.success({pages: {pageNo: pageNo, pageSize: pageSize, totalCount: 0, totalPage: 0}, tables: []});\n    }\n    return this.success({pages: {pageNo: pageNo, pageSize: pageSize, totalCount: result.count, totalPage: result.totalPages}, tables: result.data});\n  }\n\n  async queryallAction() {\n    let userInfo = await this.session(\"userInfo\");\n    if(think.isEmpty(userInfo)) {\n      return this.fail(Enum.NOT_NOGIN.code, Enum.NOT_NOGIN.msg);\n    }\n    let result = await this.model(\"project\").join({\n      table: \"userAuth\",\n      join: \"inner\",\n      as: 'ua',\n      on: ['id', 'projectId']\n    }).where({'ua.userId': userInfo.id}).field(\"project.id,project.projectName,project.projectPrefix\").select();\n    return this.success(result);\n  }\n\n  async addAction() {\n    let projectName = this.get('projectName');\n    let projectPrefix = this.get('projectPrefix');\n    let proxyURL = this.get('proxyURL');\n    let userInfo = await this.session(\"userInfo\");\n    if(think.isEmpty(userInfo)) {\n      return this.fail(Enum.NOT_NOGIN.code, Enum.NOT_NOGIN.msg);\n    }\n    let model = this.model(\"project\");\n    // let insertId = await model.transaction( async function * () {\n    //   let projectId = await model.add({projectName: projectName, projectPrefix: projectPrefix, proxyURL: proxyURL});\n    //   return await this.model('userAuth').add({userId: userInfo.id, projectId: projectId, isManage: 1});\n    // })\n    // let insertId = await this.model(\"project\").add({projectName: projectName, projectPrefix: projectPrefix, proxyURL: proxyURL});\n    try {\n      // await model.startTrans();\n      let projectId = await model.add({projectName: projectName, projectPrefix: projectPrefix, proxyURL: proxyURL});\n      let insertId = await this.model(\"userAuth\").add({userId: userInfo.id, projectId: projectId, isManage: 1});\n      // await model.commit();\n    } catch(e) {\n      // await model.rollback();\n      return this.fail(Enum.ADD_ERROR.code, Enum.ADD_ERROR.msg);\n    }\n    return this.success();\n  }\n\n  async editAction() {\n    let id = this.get('id');\n    let projectName = this.get('projectName');\n    let projectPrefix = this.get('projectPrefix');\n    let proxyURL = this.get('proxyURL');\n    let model = this.model(\"project\");\n    let userInfo = await this.session(\"userInfo\");\n    if(think.isEmpty(userInfo)) {\n      return this.fail(Enum.NOT_NOGIN.code, Enum.NOT_NOGIN.msg);\n    }\n    try {\n      let affectedRows = await model.where({id: id}).update({projectName: projectName, projectPrefix: projectPrefix, proxyURL: proxyURL});\n    } catch(e) {\n      return this.fail(Enum.EDIT_ERROR.code, Enum.EDIT_ERROR.msg);\n    }\n    return this.success();\n  }\n\n  async deleteAction() {\n    let id = this.get('id');\n    let userInfo = await this.session(\"userInfo\");\n    if(think.isEmpty(userInfo)) {\n      return this.fail(Enum.NOT_NOGIN.code, Enum.NOT_NOGIN.msg);\n    }\n    let model = this.model(\"project\");\n    try {\n      let interfaceCount = this.model(\"interface\").field(\"id\").where({projectId: id}).count();\n      if(interfaceCount > 0) {\n        return this.fail(Enum.DELETE_PROJECT_INTERFACE_ERROR.code, Enum.DELETE_PROJECT_INTERFACE_ERROR.msg);\n      }\n      await this.model(\"userAuth\").where({projectId: id}).delete();\n      await model.where({id: id}).delete();\n    } catch(e) {\n      return this.fail(Enum.DELETE_ERROR.code, Enum.DELETE_ERROR.msg);\n    }\n    return this.success();\n  }\n}\n"
    ]
}